<div class="import-container leoni-theme">
  <mat-card class="leoni-card">
    <mat-card-header class="leoni-header">
      <div class="header-content">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRH6jQbkAsSUgXIch5K_oPxRaLEPWzDbk42zQ&s" alt="Leoni Logo" class="logo">
        <div>
          <mat-card-title class="leoni-title">Import Equipment Data</mat-card-title>
          <mat-card-subtitle class="leoni-subtitle">Upload an Excel file with equipment pricing data</mat-card-subtitle>
        </div>
      </div>
    </mat-card-header>

    <mat-card-content class="leoni-content">
      <!-- File Upload Section -->
      <div class="file-upload-section leoni-upload-area">
        <div class="upload-container">
          <button 
            mat-raised-button 
            class="leoni-upload-btn"
            (click)="fileInput.click()"
            [disabled]="isUploading || isAnalyzing">
            <mat-icon>cloud_upload</mat-icon>
            Select Excel File
          </button>
          <input 
            hidden 
            #fileInput 
            type="file" 
            accept=".xlsx, .xls" 
            (change)="onFileSelected($event)"
            [disabled]="isUploading || isAnalyzing">
          
          <div class="file-info">
            <span class="file-name" *ngIf="fileName">
              <mat-icon>description</mat-icon>
              {{ fileName }}
            </span>
            
            <div class="file-status-container" *ngIf="selectedFile">
              <mat-spinner *ngIf="isAnalyzing" diameter="20"></mat-spinner>
              <mat-icon *ngIf="isValidFile && !isAnalyzing" color="primary">check_circle</mat-icon>
              <mat-icon *ngIf="!isValidFile && !isAnalyzing" color="warn">error</mat-icon>
              <span *ngIf="isAnalyzing" class="status-text">Analyzing file...</span>
              <span *ngIf="isValidFile && !isAnalyzing" class="status-text valid">Valid file structure</span>
              <span *ngIf="!isValidFile && !isAnalyzing && error" class="status-text error">{{ error }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- File Analysis Section -->
      <div *ngIf="fileAnalysis" class="file-analysis leoni-analysis">
        <h3 class="analysis-title"><mat-icon>analytics</mat-icon> File Analysis</h3>
        
        <div class="analysis-grid">
          <!-- Detected Columns -->
          <div class="analysis-card">
            <h4 class="analysis-subtitle">
              <mat-icon>view_column</mat-icon>
              Detected Columns
            </h4>
            <div *ngIf="fileAnalysis.detectedColumns" class="column-list">
              <div class="column-item" *ngFor="let item of fileAnalysis.detectedColumns | keyvalue">
                <mat-icon class="column-icon">check_circle</mat-icon>
                <span class="column-name">{{ item.key }}</span>
                <span class="column-type">{{ item.value }}</span>
              </div>
            </div>
          </div>

          <!-- Year Columns -->
          <div class="analysis-card">
            <h4 class="analysis-subtitle">
              <mat-icon>calendar_today</mat-icon>
              Year Columns
            </h4>
            <div *ngIf="fileAnalysis.yearColumns?.length" class="year-list">
              <div class="year-item" *ngFor="let col of fileAnalysis.yearColumns">
                <div class="year-badge">{{ col.year }}</div>
                <span class="year-header">{{ col.headerName }}</span>
              </div>
            </div>
            <div *ngIf="!fileAnalysis.yearColumns?.length" class="warning-message">
              <mat-icon>warning</mat-icon>
              <span>No year columns detected. Make sure the file contains unit price columns.</span>
            </div>
          </div>

          <!-- Mapping Information -->
          <div class="analysis-card" *ngIf="fileAnalysis.mappingInfo">
            <h4 class="analysis-subtitle">
              <mat-icon>link</mat-icon>
              Mapping Information
            </h4>
            <div class="mapping-list">
              <div class="mapping-item" *ngFor="let item of fileAnalysis.mappingInfo | keyvalue">
                <span class="mapping-key">{{ item.key }}:</span>
                <span class="mapping-value">{{ item.value }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <mat-divider *ngIf="isValidFile" class="leoni-divider"></mat-divider>

      <!-- Import Options -->
      <div *ngIf="isValidFile" class="import-options leoni-options">
        <h3 class="options-title"><mat-icon>tune</mat-icon> Import Options</h3>
        
        <div class="option-item">
          <mat-slide-toggle 
            [(ngModel)]="replaceExisting" 
            color="primary" 
            class="leoni-toggle">
            Replace existing equipment data
          </mat-slide-toggle>
          <div class="option-hint">
            <mat-icon>info</mat-icon>
            <span>
              If enabled, existing equipment with the same description will be updated with new data.
              If disabled, existing equipment will be preserved and only new items will be added.
            </span>
          </div>
        </div>
      </div>

      <!-- Import Results -->
      <div *ngIf="importResult" class="import-results leoni-results">
        <h3 class="results-title"><mat-icon>assignment_turned_in</mat-icon> Import Results</h3>
        <div class="result-grid">
          <div class="result-item success">
            <mat-icon>check_circle</mat-icon>
            <span><strong>{{ importResult.message }}</strong></span>
          </div>
          <div class="result-item">
            <mat-icon>format_list_numbered</mat-icon>
            <span>Imported items: <strong>{{ importResult.count }}</strong></span>
          </div>
          <div class="result-item">
            <mat-icon>swap_horiz</mat-icon>
            <span>Replaced existing: <strong>{{ importResult.replacedExisting ? 'Yes' : 'No' }}</strong></span>
          </div>
        </div>
      </div>

      <!-- Error Display -->
      <div *ngIf="error && !isValidFile" class="error-container leoni-error">
        <mat-icon>error</mat-icon>
        <span>{{ error }}</span>
      </div>
    </mat-card-content>

    <mat-card-actions align="end" class="leoni-actions">
      <div class="flex justify-end space-x-4">
        <!-- Reset Button -->
        <button
          mat-button
          class="leoni-cancel-btn flex items-center px-4 py-2 rounded-md transition-all duration-200"
          [class]="{
            'opacity-50 cursor-not-allowed': isUploading || isAnalyzing || !selectedFile,
            'hover:bg-gray-100 active:bg-gray-200': !(isUploading || isAnalyzing || !selectedFile)
          }"
          (click)="resetForm()" 
          [disabled]="isUploading || isAnalyzing || !selectedFile"
        >
          <mat-icon class="mr-2 text-gray-600">clear</mat-icon>
          <span class="text-gray-700 font-medium">Reset</span>
        </button>
      
        <!-- Import Button -->
        <button
          mat-raised-button
          class="leoni-import-btn flex items-center px-6 py-2 rounded-md shadow-sm transition-all duration-200"
          [class]="{
            'bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white': !isUploading && isValidFile,
            'bg-blue-300 cursor-not-allowed text-white': isUploading || !isValidFile || isAnalyzing
          }"
          (click)="importData()" 
          [disabled]="!isValidFile || isUploading || isAnalyzing"
        >
          <span class="flex items-center">
            <mat-icon *ngIf="!isUploading" class="mr-2">publish</mat-icon>
            <mat-spinner *ngIf="isUploading" diameter="20" class="mr-2"></mat-spinner>
            <span class="font-medium">
              {{ isUploading ? 'Importing...' : 'Import Data' }}
            </span>
          </span>
        </button>
      </div>
    </mat-card-actions>
  </mat-card>
</div>